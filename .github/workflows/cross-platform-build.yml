name: Buffer Overflow Test

on: [push, pull_request]

jobs:
  ubuntu-gcc:
    name: Ubuntu (GCC)
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install GCC
        run: |
          sudo apt-get update
          sudo apt-get install -y g++

      - name: Compile without protection
        run: |
          g++ -std=c++17 -fno-stack-protector -no-pie -O0 -o overflow main.cpp
          echo "=== Running without protection (mode 3) ==="
          echo "3" | ./overflow || true
          ls -a

      - name: Compile with stack protector
        run: |
          g++ -std=c++17 -fstack-protector-all -O1 -o overflow_protected main.cpp
          echo "=== Running with stack protector (mode 3) ==="
          echo "3" | ./overflow_protected || true
          ls -a

      - name: Compile with AddressSanitizer
        run: |
          g++ -std=c++17 -fsanitize=address -g -O1 -o overflow_asan main.cpp
          echo "=== Running with AddressSanitizer (mode 3) ==="
          echo "3" | ./overflow_asan || true
          ls -a

  ubuntu-clang:
    name: Ubuntu (Clang)
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install Clang
        run: |
          sudo apt-get update
          sudo apt-get install -y clang

      - name: Compile without protection
        run: |
          clang++ -std=c++17 -fno-stack-protector -no-pie -O0 -o overflow main.cpp
          echo "=== Running without protection (mode 3) ==="
          echo "3" | ./overflow || true
          ls -a

      - name: Compile with stack protector
        run: |
          clang++ -std=c++17 -fstack-protector-all -O1 -o overflow_protected main.cpp
          echo "=== Running with stack protector (mode 3) ==="
          echo "3" | ./overflow_protected || true
          ls -a

      - name: Compile with AddressSanitizer
        run: |
          clang++ -std=c++17 -fsanitize=address -g -O1 -o overflow_asan main.cpp
          echo "=== Running with AddressSanitizer (mode 3) ==="
          echo "3" | ./overflow_asan || true
          ls -a
